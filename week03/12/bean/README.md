# ICMP, IPv6, 라우팅 알고리즘

---

## 목차

1. [ICMP (Internet Control Message Protocol)](#1-icmp-internet-control-message-protocol)
2. [IPv6](#2-ipv6)
3. [라우팅 알고리즘 개요](#3-라우팅-알고리즘-개요)
4. [링크 상태 라우팅 알고리즘](#4-링크-상태-라우팅-알고리즘)
5. [거리 벡터 라우팅 알고리즘](#5-거리-벡터-라우팅-알고리즘)

---

## 1. ICMP (Internet Control Message Protocol)

### ICMP의 정의와 역할

#### 1.1 ICMP 개요
- **정의**: 호스트와 라우터가 네트워크 계층 정보를 통신하기 위한 프로토콜
- **위치**: IP "위에" 있는 네트워크 계층 프로토콜
- **캡슐화**: ICMP 메시지가 IP 데이터그램에 담겨 전송됨

#### 1.2 ICMP 메시지 구조
```
ICMP 메시지 = 타입 + 코드 + IP 데이터그램의 처음 8바이트
```

### ICMP 메시지 타입

#### 1.3 주요 ICMP 메시지

| 타입 | 코드 | 설명 |
|------|------|------|
| **0** | **0** | echo reply (ping 응답) |
| **3** | **0** | dest. network unreachable (목적지 네트워크 도달 불가) |
| **3** | **1** | dest host unreachable (목적지 호스트 도달 불가) |
| **3** | **2** | dest protocol unreachable (목적지 프로토콜 도달 불가) |
| **3** | **3** | dest port unreachable (목적지 포트 도달 불가) |
| **3** | **6** | dest network unknown (목적지 네트워크 알 수 없음) |
| **3** | **7** | dest host unknown (목적지 호스트 알 수 없음) |
| **4** | **0** | source quench (혼잡 제어 - 사용 안 함) |
| **8** | **0** | echo request (ping 요청) |
| **9** | **0** | route advertisement (라우터 광고) |
| **10** | **0** | router discovery (라우터 발견) |
| **11** | **0** | TTL expired (TTL 만료) |
| **12** | **0** | bad IP header (잘못된 IP 헤더) |

### Traceroute와 ICMP

#### 1.4 Traceroute 동작 원리
**우체국 배달 추적 비유:**
- **우체국**: 라우터
- **편지**: UDP 세그먼트
- **배달 추적**: 각 우체국을 거쳐가는 경로 확인

#### 1.5 Traceroute 과정
```
1단계: TTL=1인 UDP 세그먼트 전송
→ 첫 번째 라우터에서 ICMP "TTL expired" 메시지 반환

2단계: TTL=2인 UDP 세그먼트 전송
→ 두 번째 라우터에서 ICMP "TTL expired" 메시지 반환

3단계: TTL=3인 UDP 세그먼트 전송
→ 세 번째 라우터에서 ICMP "TTL expired" 메시지 반환

...

최종: 목적지에 도달하면 ICMP "port unreachable" 메시지 반환
```

#### 1.6 Traceroute 특징
- **3개 프로브**: 각 TTL 값마다 3개의 UDP 세그먼트 전송
- **RTT 측정**: ICMP 메시지가 돌아오는 시간 측정
- **라우터 정보**: ICMP 메시지에 라우터 이름과 IP 주소 포함
- **중단 조건**: 목적지에서 "port unreachable" 메시지 수신

---

## 2. IPv6

### IPv6의 등장 배경

#### 2.1 IPv6 동기
- **주요 동기**: 32비트 주소 공간이 곧 완전히 할당될 예정
- **추가 동기**: 
  - 헤더 형식이 처리/포워딩 속도 향상에 도움
  - QoS를 위한 헤더 변경
  - 고정 길이 40바이트 헤더
  - 단편화 불허

#### 2.2 IPv6 데이터그램 형식
```
┌─────────────────────────────────────────────────────────────────┐
│                    IPv6 Header (40 bytes)                      │
├─────────────────────────────────────────────────────────────────┤
│ version │ priority │ flow label                                │
├─────────────────────────────────────────────────────────────────┤
│ payload length │ next header │ hop limit                       │
├─────────────────────────────────────────────────────────────────┤
│                    source address (128 bits)                   │
├─────────────────────────────────────────────────────────────────┤
│                   destination address (128 bits)                │
├─────────────────────────────────────────────────────────────────┤
│                    data (variable length)                      │
└─────────────────────────────────────────────────────────────────┘
```

#### 2.3 IPv6 헤더 필드

**버전 (Version)**
- **의미**: IP 프로토콜 버전 번호 (6)

**우선순위 (Priority)**
- **의미**: 플로우 내 데이터그램 간 우선순위 식별

**플로우 라벨 (Flow Label)**
- **의미**: 동일한 "플로우"의 데이터그램 식별
- **특징**: "플로우" 개념이 명확히 정의되지 않음

**페이로드 길이 (Payload Length)**
- **의미**: 데이터 부분의 길이

**다음 헤더 (Next Header)**
- **의미**: 데이터의 상위 계층 프로토콜 식별

**홉 제한 (Hop Limit)**
- **의미**: TTL과 동일한 기능

**출발지/목적지 주소**
- **의미**: 128비트 IP 주소

### IPv4에서 IPv6로의 변화

#### 2.4 주요 변경사항

**체크섬 제거**
- **변경**: 완전히 제거됨
- **이유**: 각 홉에서 처리 시간 단축

**옵션 처리**
- **변경**: 헤더 외부에 배치
- **지정**: "Next Header" 필드로 표시

**ICMPv6**
- **변경**: ICMP의 새로운 버전
- **추가 기능**: "Packet Too Big" 등 새로운 메시지 타입
- **멀티캐스트**: 그룹 관리 기능

### IPv4에서 IPv6로의 전환

#### 2.5 전환의 어려움
- **문제**: 모든 라우터를 동시에 업그레이드할 수 없음
- **해결책**: "flag days" 없이 점진적 전환

#### 2.6 터널링 (Tunneling)
**터널링의 개념:**
- IPv6 데이터그램을 IPv4 데이터그램의 페이로드로 캡슐화
- IPv4 라우터들 사이에서 IPv6 데이터그램 전송

**터널링 예시:**
```
논리적 뷰: IPv6 ── IPv6 ── IPv6 ── IPv6 ── IPv6 ── IPv6
물리적 뷰: IPv6 ── IPv6 ── IPv4 ── IPv4 ── IPv6 ── IPv6
```

**터널링 과정:**
1. A→B: IPv6 데이터그램 전송
2. B→C: IPv6 데이터그램을 IPv4로 캡슐화
3. C→D: IPv4 데이터그램 전송
4. D→E: IPv6 데이터그램 추출하여 IPv4로 캡슐화
5. E→F: IPv6 데이터그램 전송

---

## 3. 라우팅 알고리즘 개요

### 라우팅과 포워딩의 상호작용

#### 3.1 라우팅 알고리즘의 역할
- **라우팅 알고리즘**: 네트워크를 통한 엔드-투-엔드 경로 결정
- **포워딩 테이블**: 이 라우터에서의 로컬 포워딩 결정
- **상호작용**: 라우팅 알고리즘이 포워딩 테이블을 생성

#### 3.2 포워딩 테이블 예시
```
목적지 주소 범위    출력 링크
주소 범위 1        3
주소 범위 2        2
주소 범위 3        2
주소 범위 4        1
```

### 그래프 추상화

#### 3.3 네트워크를 그래프로 표현
**그래프 정의:**
- **G = (N,E)**: 노드 집합 N과 링크 집합 E
- **N**: 라우터 집합 = {u, v, w, x, y, z}
- **E**: 링크 집합 = {(u,v), (u,x), (v,x), (v,w), (x,w), (x,y), (w,y), (w,z), (y,z)}

#### 3.4 비용 개념
**링크 비용:**
- **c(x,x')**: 노드 x에서 x'까지의 링크 비용
- **예시**: c(w,z) = 5

**경로 비용:**
- **경로 (X1, X2, X3, ..., Xp)의 비용**: c(X1,X2) + c(X2,X3) + ... + c(Xp-1,Xp)
- **목표**: u에서 z까지의 최소 비용 경로 찾기

### 라우팅 알고리즘 분류

#### 3.5 정보 범위에 따른 분류

**글로벌 (Global)**
- **특징**: 모든 라우터가 완전한 토폴로지, 링크 비용 정보 보유
- **알고리즘**: "링크 상태" 알고리즘

**분산 (Decentralized)**
- **특징**: 라우터가 물리적으로 연결된 이웃과 이웃까지의 링크 비용만 알고 있음
- **알고리즘**: "거리 벡터" 알고리즘

#### 3.6 변화 속도에 따른 분류

**정적 (Static)**
- **특징**: 경로가 시간에 따라 천천히 변화
- **예시**: 수동 설정

**동적 (Dynamic)**
- **특징**: 경로가 더 빠르게 변화
- **방식**: 주기적 업데이트, 링크 비용 변화에 대한 응답

---

## 4. 링크 상태 라우팅 알고리즘

### 다익스트라 알고리즘

#### 4.1 다익스트라 알고리즘 개요
- **목표**: 한 노드('소스')에서 모든 다른 노드까지의 최소 비용 경로 계산
- **입력**: 네트워크 토폴로지, 링크 비용
- **출력**: 해당 노드의 포워딩 테이블
- **방식**: 반복적 (k번 반복 후 k개 목적지까지의 최소 비용 경로를 알게 됨)

#### 4.2 표기법
- **c(x,y)**: 노드 x에서 y까지의 링크 비용 (직접 이웃이 아니면 ∞)
- **D(v)**: 소스에서 목적지 v까지의 경로 비용의 현재 값
- **p(v)**: 소스에서 v까지의 경로에서 v의 전임자 노드
- **N'**: 최소 비용 경로가 확실히 알려진 노드들의 집합

#### 4.3 다익스트라 알고리즘
```
1. 초기화:
   N' = {u}
   모든 노드 v에 대해:
   if v가 u에 인접하면 D(v) = c(u,v)
   else D(v) = ∞

2. 반복:
   N'에 없는 노드 w 중 D(w)가 최소인 것을 찾음
   w를 N'에 추가
   w에 인접하고 N'에 없는 모든 v에 대해 D(v) 업데이트:
   D(v) = min(D(v), D(w) + c(w,v))
   모든 노드가 N'에 들어갈 때까지 반복
```

#### 4.4 다익스트라 알고리즘 예시

**네트워크 토폴로지:**
```
    9
    u ──── v
  5 │     │ 3
    │     │
  7 │     │ 2
    │     │
    w ──── x
  4 │     │ 3
    │     │
  2 │     │ 7
    │     │
    y ──── z
```

**알고리즘 실행 과정:**

| 단계 | N' | D(v),p(v) | D(w),p(w) | D(x),p(x) | D(y),p(y) | D(z),p(z) |
|------|----|-----------|-----------|-----------|-----------|-----------|
| **0** | **u** | **7,u** | **3,u** | **5,u** | **∞** | **∞** |
| **1** | **uw** | **6,w** | **3,u** | **5,u** | **11,w** | **∞** |
| **2** | **uwx** | **6,w** | **3,u** | **5,u** | **11,w** | **14,x** |
| **3** | **uwxv** | **6,w** | **3,u** | **5,u** | **10,v** | **14,x** |
| **4** | **uwxvy** | **6,w** | **3,u** | **5,u** | **10,v** | **12,y** |
| **5** | **uwxvyz** | **6,w** | **3,u** | **5,u** | **10,v** | **12,y** |

#### 4.5 다익스트라 알고리즘의 특징

**알고리즘 복잡도:**
- **n개 노드**: 각 반복에서 N'에 없는 모든 노드 w를 확인해야 함
- **비교 횟수**: n(n+1)/2 비교, O(n²)
- **효율적 구현**: O(n log n) 가능

**진동 가능성:**
- **문제**: 링크 비용이 전송되는 트래픽 양과 같을 때
- **결과**: 라우팅이 계속 변화하는 진동 발생
- **예시**: A→B→C→D 경로가 계속 바뀜

---

## 5. 거리 벡터 라우팅 알고리즘

### 벨만-포드 방정식

#### 5.1 벨만-포드 방정식 정의
**동적 프로그래밍 기반:**
```
dₓ(y) = min {c(x,v) + dᵥ(y)}
```

**구성 요소:**
- **dₓ(y)**: x에서 y까지의 최소 비용 경로 비용
- **c(x,v)**: x에서 이웃 v까지의 비용
- **dᵥ(y)**: 이웃 v에서 목적지 y까지의 비용
- **min**: x의 모든 이웃 v에 대해 최소값

#### 5.2 거리 벡터 알고리즘의 특징
- **분산적**: 각 노드가 이웃과만 정보 교환
- **반복적**: 계산과 정보 교환의 반복 과정
- **동적**: 링크 비용 변화에 반응

#### 5.3 거리 벡터 알고리즘 과정
```
각 노드 x에 대해:
1. 초기화: 모든 목적지 y에 대해 Dₓ(y) = c(x,y) if y가 이웃이면, ∞ otherwise
2. 반복:
   각 이웃 v에 대해:
   Dₓ(y) = min {c(x,v) + Dᵥ(y)} for all destinations y
3. 모든 노드의 거리 벡터가 수렴할 때까지 반복
```

#### 5.4 거리 벡터 알고리즘의 장단점

**장점:**
- **단순함**: 구현이 간단
- **분산적**: 각 노드가 독립적으로 계산
- **효율적**: 이웃과만 정보 교환

**단점:**
- **수렴 속도**: 느린 수렴
- **카운트-투-인피니티**: 무한 루프 가능성
- **부분적 정보**: 전체 네트워크 토폴로지를 모름

#### 5.5 카운트-투-인피니티 문제
**문제 상황:**
- 노드 A가 노드 C에 도달하기 위해 노드 B를 거쳐감
- 노드 B와 C 사이의 링크가 끊어짐
- 노드 B가 노드 A를 통해 C에 도달하려고 함
- 노드 A가 노드 B를 통해 C에 도달하려고 함
- 무한 루프 발생

**해결책:**
- **스플릿 호라이즌**: 경로 정보를 특정 방향으로만 전파
- **포이즌 리버스**: 잘못된 경로 정보를 무한대로 표시

---

## 요약

### 핵심 개념 정리

1. **ICMP**: 네트워크 계층 제어 메시지 프로토콜
2. **IPv6**: 128비트 주소를 사용하는 차세대 IP 프로토콜
3. **라우팅 알고리즘**: 최적 경로를 찾는 알고리즘
4. **링크 상태**: 전체 네트워크 정보를 사용하는 라우팅
5. **거리 벡터**: 이웃 정보만 사용하는 라우팅

### 학습 목표 달성

- ICMP 메시지 타입과 Traceroute 동작 원리 이해
- IPv6의 특징과 IPv4에서의 전환 방법 학습
- 라우팅 알고리즘의 분류와 특징 파악
- 다익스트라 알고리즘의 동작 과정 이해
- 거리 벡터 알고리즘의 장단점과 문제점 학습

---

> 본 내용은 강의 슬라이드와 교재 내용을 바탕으로 정리하였다.
